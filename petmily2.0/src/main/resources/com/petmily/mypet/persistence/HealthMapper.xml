<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.petmily.mypet.persistence.HealthMapper"> <!-- namespace 중요 , 정해진 이름은 없음 자기가 지으면 됨-->
	<!-- 인터페이스의 패키지명 kosta.mapper, 인터페이스명 BoardMapper -->
	<cache />

	<!-- <select id="selectAllPet" resultType="com.petmily.mypet.domain.PetVO" parameterType="String">
		select * from pets_tb where mem_id = #{mem_id} order by pet_odr_no
	</select>
	<select id="selectAllWeight" resultType="HealthVO" parameterType="int"> 
		select * from HEALTH_RECORDS_TB where pet_no = #{pet_no} order by health_record_dt
	</select>
	
	<select id="countData" resultType="int" parameterType="HealthVO">
		select count(*) from HEALTH_RECORDS_TB where pet_no = #{pet_no} and health_record_dt = TO_DATE(#{health_record_dt}, 'YYYY-MM-DD')
	</select>
	<insert id="insertData" parameterType="HealthVO">
		insert into HEALTH_RECORDS_TB(HEALTH_RECORDS_NO,PET_NO,MEM_ID,HEALTH_RECORD_DT)
					values(HEALTH_RECORDS_TB_SEQ.nextval,							
							#{pet_no},
							#{mem_id},
							TO_DATE(#{health_record_dt}, 'YYYY-MM-DD')
							
							)
	</insert>
	<update id="updateAll" parameterType="HealthVO">
		update HEALTH_RECORDS_TB set walking = #{walking},
									 bath = #{bath},
									 rapport = #{rapport},
									 brush_teeth = #{brush_teeth},
									 urine_color = #{urine_color},
									 stool_color = #{stool_color},
									 stool_pattern = #{stool_pattern},
									 health_memo = #{health_memo},
									 weight = #{weight}
									 where pet_no = #{pet_no} and health_record_dt = TO_DATE(#{health_record_dt}, 'YYYY-MM-DD')
	</update>
	<select id="selectAllData" resultType="HealthVO" parameterType="HealthVO">
		select * from HEALTH_RECORDS_TB where pet_no = #{pet_no} and health_record_dt = TO_DATE(#{health_record_dt}, 'YYYY-MM-DD')
	</select>
	
	<select id="selectHosptTmt" resultType="HosptMedVO" parameterType="HealthVO">
		select * from HOSPT_MED_RECORDS_TB r join HOSPITAL_TB h on r.HOSPT_NO = h.HOSPT_NO where pet_no = #{pet_no}
	</select>
	
	<select id="countTmt" resultType="int" parameterType="MemMedVO">
		select count(*) from MEM_MED_RECORDS_TB where pet_no = #{pet_no} and MEM_TMT_DT = TO_DATE(#{mem_tmt_dt}, 'YYYY-MM-DD')
	</select>
	<insert id="insertTmt" parameterType="MemMedVO">
		insert into MEM_MED_RECORDS_TB(MEM_MED_RECORD_NO,PET_NO,MEM_ID,MEM_TMT_DT)
					values(MEM_MED_RECORDS_TB_SEQ.nextval,							
							#{pet_no},
							#{mem_id},
							TO_DATE(#{mem_tmt_dt}, 'YYYY-MM-DD')
							
							)
	</insert>
	<update id="updateTmt" parameterType="MemMedVO">
		update MEM_MED_RECORDS_TB set MEM_TMT_SORT = #{mem_tmt_sort},
									 MEM_TMT_CONTENTS = #{mem_tmt_contents}
									 where pet_no = #{pet_no} and mem_tmt_dt = TO_DATE(#{mem_tmt_dt}, 'YYYY-MM-DD')
	</update>
	<select id="selectTmt" resultType="MemMedVO" parameterType="MemMedVO">
		select * from MEM_MED_RECORDS_TB where pet_no = #{pet_no} and MEM_TMT_DT = TO_DATE(#{mem_tmt_dt}, 'YYYY-MM-DD')
	</select> -->
	
	<!-- Immunization -->
	<insert id="insertBasicImmu">
		insert into IMMUNIZATION_TB
			values(IMMUNIZATION_TB_SEQ.nextval,
					#{petNo},
					#{memId},
					#{immuNm},
					#{immuSeries},					
					#{immuDt},
					#{petMonth},
					#{hosptNm},
					'basic',
					0
			)
	</insert>
	
	<select id="selectBasicImmu" resultType="com.petmily.mypet.domain.ImmuVO">
		select * from IMMUNIZATION_TB where pet_no = #{petNo} and immu_sort = 'basic'
	</select>
	
	<delete id="deleteBasicImmu">
		delete from IMMUNIZATION_TB where pet_no = #{petNo} and immu_nm = #{immuNm} and pet_month = #{petMonth} and immu_sort = 'basic'
	</delete>
	
	<!-- booster -->
	<insert id="insertBoosterImmu">
		insert into IMMUNIZATION_TB
			values(IMMUNIZATION_TB_SEQ.nextval,
					#{petNo},
					#{memId},
					#{immuNm},
					'0',					
					#{immuDt},
					#{petMonth},
					#{hosptNm},
					'booster',
					0
			)
	</insert>
	
	<select id="selectBoosterImmu" resultType="com.petmily.mypet.domain.ImmuVO">
		select * from IMMUNIZATION_TB where pet_no = #{petNo} and pet_month = #{petMonth} and immu_sort = 'booster'
	</select>
	
	<delete id="deleteBoosterImmu">
		delete from IMMUNIZATION_TB where pet_no = #{petNo} and immu_nm = #{immuNm} and pet_month = #{petMonth} and immu_sort = 'booster'
	</delete>
	
	<!-- di -->
	<insert id="insertDiImmu">
		insert into IMMUNIZATION_TB
			values(IMMUNIZATION_TB_SEQ.nextval,
					#{petNo},
					#{memId},
					#{immuNm},
					'0',					
					#{immuDt},
					#{petMonth},
					#{hosptNm},
					'di',
					#{diYear}
			)
	</insert>
	
	<select id="selectDiImmu" resultType="com.petmily.mypet.domain.ImmuVO">
		select * from IMMUNIZATION_TB where pet_no = #{petNo} and immu_nm = '심장사상충' and di_year = #{diYear} and immu_sort = 'di'
	</select>
	
	<delete id="deleteDiImmu">
		delete from IMMUNIZATION_TB where pet_no = #{petNo} and immu_nm = #{immuNm} and pet_month = #{petMonth} and di_year = #{diYear} and immu_sort = 'di'
	</delete>
	
	<select id="allRSVN" resultType="com.petmily.mypet.domain.RsvnVO">
		select * from RESERVATION_TB r JOIN HOSPITAL_MEMBER_TB h ON r.RESERVATION_HOSPITAL_ID = h.HSPT_ID where RESERVATION_PET_NO = #{reservationPetNo} order by RESERVATION_NO
	</select>
	<select id="selectRSVN" resultType="com.petmily.mypet.domain.RsvnVO">
		select * from RESERVATION_TB r 
					JOIN HOSPITAL_MEMBER_TB h 
					ON r.RESERVATION_HOSPITAL_ID = h.HSPT_ID 
					JOIN HOSPT_MED_RECORDS_TB m 
					ON r.RESERVATION_NO = m.RESERVATION_NO
					where r.RESERVATION_PET_NO = #{reservationPetNo} and r.RESERVATION_NO = #{reservationNo}
	</select>
	<select id="allMed" resultType="com.petmily.mypet.domain.MedVO">
		<!-- <bind name="dtStart" value="_parameter.dtStart"/>
		<bind name="dtEnd" value="_parameter.dtEnd"/> -->
		select * from(
			SELECT HOSPT_MED_RECORDS_TB.HOSPT_MED_RECORDS_NO,HOSPT_MED_RECORDS_TB.PET_NO,HOSPT_MED_RECORDS_TB.HOSPT_TMT_DT as dt,HOSPT_MED_RECORDS_TB.HOSPT_TMT_SORT,HOSPT_MED_RECORDS_TB.HOSPT_TMT_CONTENTS, HOSPT_MED_RECORDS_TB.HSPT_NAME, 'hospt' AS SORT FROM HOSPT_MED_RECORDS_TB WHERE pet_no = #{petNo}
			<![CDATA[
       			 and HOSPT_MED_RECORDS_TB.HOSPT_TMT_DT >=TO_DATE(#{dtStart},'yyyy-mm-dd') AND HOSPT_MED_RECORDS_TB.HOSPT_TMT_DT <= TO_DATE(#{dtEnd},'yyyy-mm-dd')+(INTERVAL '1' DAY)  
    		]]>

			
			UNION ALL
			 
			SELECT MEM_MED_RECORDS_TB.MEM_MED_RECORD_NO, MEM_MED_RECORDS_TB.PET_NO,MEM_MED_RECORDS_TB.MEM_TMT_DT as dt,MEM_MED_RECORDS_TB.MEM_TMT_SORT,MEM_MED_RECORDS_TB.MEM_TMT_CONTENTS, MEM_MED_RECORDS_TB.HOSPT_NM,'mem' AS SORT  FROM MEM_MED_RECORDS_TB WHERE pet_no = #{petNo}
			<![CDATA[
       			 and MEM_MED_RECORDS_TB.MEM_TMT_DT >=TO_DATE(#{dtStart},'yyyy-mm-dd') AND MEM_MED_RECORDS_TB.MEM_TMT_DT <= TO_DATE(#{dtEnd},'yyyy-mm-dd')+(INTERVAL '1' DAY)  
    		]]>
			) order by dt
	</select>
	<insert id="insertMemMed">
		insert into MEM_MED_RECORDS_TB values(
											MEM_MED_RECORDS_TB_SEQ.nextval,
											#{petNo},
											#{memId},
											#{memTmtDt},
											#{memTmtSort},
											#{memTmtContents},
											#{hosptNm})
	</insert>
	<delete id="deleteMemMed">
		delete from MEM_MED_RECORDS_TB where MEM_MED_RECORD_NO = #{memMedRecordNo}
	</delete>
</mapper>















